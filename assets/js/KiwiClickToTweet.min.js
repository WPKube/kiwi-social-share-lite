!function(){var a=function(a){for(var b="",c=0;c<23;c++)b+="o";return a.replace(/(http:\/\/[\S]*)/g,b).length},b=function(a){var b={action:"kiwi_social_share_get_option",args:{group:"kiwi_social_identities",option:"twitter_username",default:!1}};jQuery.ajax({dataType:"json",type:"POST",url:ajaxurl,data:b,complete:function(b){b.responseJSON&&jQuery("#"+a).attr("data-handle",b.responseJSON)}})};tinymce.PluginManager.add("KiwiClickToTweet",function(c,d){c.addButton("KiwiClickToTweet",{title:"Click to Tweet",icon:" kicon-twitter",onclick:function(){var d=(b(this._id),this._id);c.windowManager.open({title:'Build "Click to Tweet"',class:"kiwi-click-to-tweet",body:[{type:"textbox",multiline:!0,style:"height:50px",name:"tweet",label:"The text that will be sent out on Twitter.",onkeyup:function(){var b=jQuery(".mce-first textarea").val(),c=(b.length,jQuery("#"+d).attr("data-handle"));if(b.indexOf("http")>-1||b.indexOf("https")>-1?linkSpace=0:linkSpace=23,void 0===c)var e=140-a(b)-linkSpace;else var e=140-a(b)-linkSpace-c.length-6;e>1||0==e?jQuery(".tweetCounter").css({color:"green"}).text(e+" characters"):1==e?jQuery(".tweetCounter").css({color:"green"}).text(e+" character"):e<0&&jQuery(".tweetCounter").css({color:"red"}).text(e+" characters")},class:"tweetCounting"},{type:"label",name:"someHelpText",onPostRender:function(){var b=jQuery(".mce-first textarea").val(),c=(b.length,jQuery("#"+d).attr("data-handle"));if(b.indexOf("http")>-1||b.indexOf("https")>-1?linkSpace=0:linkSpace=23,void 0===c)var e=140-a(b)-linkSpace;else var e=140-a(b)-linkSpace-c.length-6;this.getEl().innerHTML='<span style="float:right;">You have <span class="tweetCounter" style="color:green">'+e+" characters</span> remaining.</span>"},text:""},{type:"textbox",multiline:!0,style:"height:50px",name:"quote",label:"The quote as it will appear in your article."},{type:"label",name:"someHelpText2",onPostRender:function(){this.getEl().innerHTML='<div style="width:650px;">&nbsp;</div>'},text:""}],onsubmit:function(a){var b=jQuery(".mce-first textarea").val(),d=b.length,e=117-d;return""===a.data.tweet||""===a.data.quote?(c.windowManager.alert("Please, fill in both fields."),!1):e<0?(c.windowManager.alert("You have too many characters in your tweet."),!1):void c.insertContent('[KiwiClickToTweet tweet="'+a.data.tweet.replace(/"/g,"'")+'" quote="'+a.data.quote.replace(/"/g,"'")+'"]')}})}})})}();